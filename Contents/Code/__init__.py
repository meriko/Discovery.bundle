TITLE = 'Discovery Networks'
ART   = 'art-default.jpg'
ICON  = 'icon-default.png'
PREFIX = '/video/discovery'
HTTP_USER_AGENT = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_5) AppleWebKit/536.26.17 (KHTML, like Gecko) Version/6.0.2 Safari/536.26.17"

CHANNELS = [ 
    {
        'title':    'Discovery Channel',
        'desc':     'Science, History, Space, Tech, Sharks, News!',
        'url':      'https://www.discoverygo.com',
        'thumb':    'http://static.ddmcdn.com/en-us/dsc//images/default-still.jpg'
    },
    {
        'title':    'Animal Planet',
        'desc':     'Animal Planet lets you explore cat breeds, dog breeds, wild animals and pets.',
        'url':      'https://www.animalplanetgo.com',
        'thumb':    'http://static.ddmcdn.com/en-us/apl//images/default-still.jpg'
    },
    {
        'title':    'Animal Planet LIVE',
        'desc':     'Animal Planet LIVE, featuring live HD cams for chicks, puppies, ants, cockroaches, penguins, kittens and many more.',
        'url':      'http://www.apl.tv',
        'thumb':    'http://static.ddmcdn.com/en-us/apltv/img/body-bg-2.jpg'
    },
    {
        'title':    'TLC',
        'desc':     'TLC TV network opens doors to extraordinary lives.',
        'url':      'https://www.tlcgo.com',
        'thumb':    'http://static.ddmcdn.com/en-us/tlc//images/default-still.jpg'
    },
    {
        'title':    'Investigation Discovery',
        'desc':     'Hollywood crimes, murder and forensic investigations. Investigation Discovery gives you insight into true stories that piece together puzzles of human nature.',
        'url':      'https://www.investigationdiscoverygo.com',
        'thumb':    'http://static.ddmcdn.com/en-us/ids//images/default-still.jpg'
    },
    {
        'title':    'Science Channel',
        'desc':     'Science Channel video and news explores wormholes, outer space, engineering, cutting-edge tech, and the latest on your favorite SCI programs!',
        'url':      'https://www.sciencechannelgo.com',
        'thumb':    'http://static.ddmcdn.com/en-us/sci//images/default-still.jpg'
    },
    {
        'title':    'Destination America',
        'desc':     'Destination America.',
        'url':      'https://www.destinationamericago.com',
        'thumb':    'http://static.ddmcdn.com/en-us/dam//images/default-still.jpg'
    },
    {
        'title':    'American Heroes',
        'desc':     '',
        'url':      'https://www.ahctvgo.com',
        'thumb':    'https://api.discovery.com/v1/images/57460cf16b66d15971c3543c?aspectRatio=original&width=300&height=&key=d06c34d5fa5f5bd74bc83'
    },
    {
        'title':    'Velocity',
        'desc':     'Get ready for Velocity!  Velocity brings the best of car programming with diverse new original series and specials.',
        'url':      'https://www.velocitychannelgo.com',
        'thumb':    'http://static.ddmcdn.com/en-us/vel//images/default-still.jpg'
    },
    {
        'title':    'Life',
        'desc':     '',
        'url':      'https://www.velocitychannelgo.com',
        'thumb':    'https://api.discovery.com/v1/images/5756ff6f6b66d15971c35706?aspectRatio=original&width=300&height=&key=d06c34d5fa5f5bd74bc83'
    }
]

LIVE_STREAMS = [
    {
        'title':    'Live Reef Shark Cam',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/14812707?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/1HWg97hZlSgUmIyYQqEkQ8/87c1c22fb49700dab99659001912e644/cd_512019.jpg'
    },
    {
        'title':    'EXPLORE.ORG Polar Bear Cam',
        'subtitle': '',
        'url':      'http://www.ustream.tv/embed/12434837?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/2it04PIS08yeCYaw0w2owA/01a2fcd0af6c8f43773b5383c770bdd5/on-thin-ice-frozen-planet.jpg'
    },
    {
        'title':    'Rhino Beetle Cam',
        'subtitle': 'Mini Monsters',
        'url':      'http://www.ustream.tv/embed/17808452?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/2kVcLTsnlOAgaImSEC6IK6/9b494cb89d14774a77641b0a54fda6fa/140009713598514523000201197_RHINO_BEETLE.jpg'
    },
    {
        'title':    'Chipmunk Cam',
        'subtitle': 'Mini Monsters',
        'url':      'http://www.ustream.tv/embed/17808553?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/7kRjdpQhDUOSyogAISWsUi/a512287755bd94469c7d155f92123a6d/140009720761014523000401197_CHIPMUNKS_BATTLE.jpg'
    },
    {
        'title':    'Penguin Cam',
        'subtitle': 'Penguins: Waddle All The Way',
        'url':      'http://www.ustream.tv/embed/13628076?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/3faYbUKmIocaiMug8Goucg/fde8d29f0113d24662d34336d5dc1fbe/138496259130514245100201197_FeistyFlipperFight.jpg'
    },
    {
        'title':    'Cape Caution Raw',
        'subtitle': 'Deadliest Catch',
        'url':      'http://www.ustream.tv/embed/17512744?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/quoyoaVZ4WAqOyKAMaIMC/dda28fc6ed0bcc90ab2334aca1f8fbe1/deadliest-catch-raw-capecaution-hero.jpg'
    }, 
    {
        'title':    'Saga Raw',
        'subtitle': 'Deadliest Catch',
        'url':      'http://www.ustream.tv/embed/17512784?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/3kmWCd34cMUeYSg8mA8oiw/26bcea9978589b5b379d8ec4bf7c7583/deadliest-catch-raw-saga-hero.jpg'
    },
    {
        'title':    'Time Bandit Raw',
        'subtitle': 'Deadliest Catch',
        'url':      'http://www.ustream.tv/embed/17512790?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/4JIrsoMgxa8QUmys0q6048/d119e09c7ffee4baf6154aef9a17edca/deadliest-catch-raw-timebandit-hero.jpg'
    },
    {
        'title':    'Wizard Raw',
        'subtitle': 'Deadliest Catch',
        'url':      'http://www.ustream.tv/embed/17512804?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/fUg7L7VUS4ow0KK8KWy06/003c00afea19768bbc22a451e3938bb0/deadliest-catch-raw-wizard-hero.jpg'
    },
    {
        'title':    'Northwestern Raw',
        'subtitle': 'Deadliest Catch',
        'url':      'http://www.ustream.tv/embed/17512776?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/2LxF5F4nxCwMM2OUmiu60Y/079f424d0d54127561500db745b030c9/deadliest-catch-raw-northwestern-hero.jpg'
    },
    {
        'title':    'Cornelia Marie Raw',
        'subtitle': 'Deadliest Catch',
        'url':      'http://www.ustream.tv/embed/17512785?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/4yINdvtCQgeiCKqQqceG8S/6ad07181ea417ee94ad14afaa0c4e25e/corneilia-marie-DLIVE.jpg.jpeg'
    },
    {
        'title':    'Sharkageddon Cam',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/18627730?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/2wSYR86e5SACKo6CiAYEqK/fd48ced77bb6503252029a87266addaa/mm_200182223-001.jpg'
    },
    {
        'title':    'Hammerhead Cam',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/20710729?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/3j24biFRuoauqkUSgEymIo/d424e8506cb4725b6a0b362151f9ff5c/hammerhead-cam.jpg'
    },
    {
        'title':    "Charlotte & Otto's Woodshed View",
        'subtitle': 'Alaska: The Last Frontier',
        'url':      'http://www.ustream.tv/embed/18105029?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/26rKcNAmi0aMaAOOoygAci/d6114d6d2038103662b9b23239d7dd1b/thumb-woodshed-cam.jpg'
    },
    {
        'title':    "Eivin & Eve's Bay View",
        'subtitle': 'Alaska: The Last Frontier',
        'url':      'http://www.ustream.tv/embed/18105033?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/6hqA41ATYI0yuQEkS2sYce/cf503c9f686f1d79b7b128fd1d9071e7/thumb-bay-cam.jpg'
    },
    {
        'title':    'Racing Extinction At The Empire State Building',
        'subtitle': 'Racing Extinction',
        'url':      'http://www.youtube.com/embed/w91i1X9UgrY?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/2A0BdqhchGyYyUi2u2EaA0/4099675c43ab8bf001e8f3802b4f51a6/racing-extinction-dlive_esb-whale.jpg'
    },
    {
        'title':    "Charlotte & Otto's Yard View",
        'subtitle': 'Alaska: The Last Frontier',
        'url':      'http://www.ustream.tv/embed/18105019?v=3&amp;wmode=opaque&amp;autoplay=true&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/24MxC51gpa2u6MA2isaYAS/33658c0598a22bc17686e178e3524e02/thumb-yard-cam.jpg'
    },
    {
        'title':    'Jaws Strike Back',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/18587592?v=3&amp;wmode=opaque&amp;autoplay=true&amp;volume=100&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/2ZFzNZjUlGSMmEIqyIS40w/a091c6e641e3f62e1fc979403996e96d/free_mm_offset_60753.jpg'
    },
    {
        'title':    'Mega Shark Cam',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/18538169?v=3&amp;wmode=opaque&amp;autoplay=true&amp;volume=100&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/4zx4Q4wRxYwUm4KwWi4GYo/ac9575568928d1b6099d8c7baf7b7cc1/33662_061.jpg'
    },
    {
        'title':    'Shark Fin Cam',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/18477618?v=3&amp;wmode=opaque&amp;autoplay=true&amp;volume=100&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/Ri6hEYDEIKK8EGaIOSuyY/0fb47b7e4f04301df3fdd2d24af6834b/mm_200362783-001.jpg'
    },
    {
        'title':    'Seal Decoy Cam',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/18477673?v=3&amp;wmode=opaque&amp;autoplay=true&amp;volume=100&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/7znmbXMZ9e0mKoCqg6aiwa/36251ec0c2648a50cd493b90e8a45c7f/17691_MULTIPLE_LEMON_SHARKS.jpg'
    },
    {
        'title':    'Shark Cage Cam',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/18504828?v=3&amp;wmode=opaque&amp;autoplay=true&amp;volume=100&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/42nMSpnMqAc8AwU0QMSms6/b6524d1cb6c0f6e25b6213e912e1f5c4/mm_200296666-001.jpg'
    },
    {
        'title':    'Monster Mako Cams',
        'subtitle': 'Shark Week',
        'url':      'http://www.ustream.tv/embed/20710697?v=3&amp;wmode=opaque&amp;autoplay=true&amp;volume=100&amp;controls=true&amp;showtitle=true',
        'thumb':    'http://images.contentful.com/uckrvucw5yd6/6APw6brG0gkcg0Cgge8MAA/c789b4cb903e17fe0540e7c7cca0484c/monster-mako-cam.jpg'
    }
]
##########################################################################################
def Start():
    Plugin.AddViewGroup("List", viewMode="List", mediaType="items")
    Plugin.AddViewGroup("InfoList", viewMode="InfoList", mediaType="items")

    # Setup the default attributes for the ObjectContainer
    ObjectContainer.title1     = TITLE
    ObjectContainer.view_group = "InfoList"
    ObjectContainer.art        = R(ART)

    # Setup the default attributes for the other objects
    DirectoryObject.thumb = R(ICON)
    DirectoryObject.art   = R(ART)
    EpisodeObject.thumb   = R(ICON)
    EpisodeObject.art     = R(ART)

    HTTP.CacheTime  = CACHE_1HOUR
    HTTP.User_Agent = HTTP_USER_AGENT

##########################################################################################
@handler(PREFIX, TITLE, art = ART, thumb = ICON)
def MainMenu():
    oc = ObjectContainer()
    
    # Add all channels
    for channel in CHANNELS:
        if channel["title"] == 'Animal Planet LIVE':
            pass
            '''
            oc.add(
                DirectoryObject(
                    key = Callback(
                        LiveStreams, 
                        title = channel["title"], 
                        url = channel["url"],
                        thumb = channel["thumb"]
                    ), 
                    title = channel["title"],
                    summary = channel["desc"],
                    thumb = channel["thumb"]
                )
            )
            '''
        else:
            oc.add(
                DirectoryObject(
                    key = Callback(
                        Episodes,
                        url = channel["url"],
                        thumb = channel["thumb"],
                        channel_title = channel["title"]
                    ), 
                    title = channel["title"],
                    summary = channel["desc"],
                    thumb = channel["thumb"]
                )
            )       
    
    oc.add(
        DirectoryObject(
            key = Callback(DLive),
            title = 'DLive',
            summary = 'Discovery fans can connect 24x7 with their favorite network and tap into an always-on experience featuring the best of our live events, cams, and raw footage!',
            thumb = 'http://static.ddmcdn.com/en-us/dsc//images/default-still.jpg'
        )
    )
    
    return oc

##########################################################################################
@route(PREFIX + "/Episodes")
def Episodes(url, thumb, channel_title):
    oc = ObjectContainer(title2 = channel_title)   
    
    GetEpisodes(url, oc, channel_title)
    
    if len(oc) < 1:
        oc.header = "Sorry"
        oc.message = "Couldn't find any episodes"
    
    return oc

##########################################################################################
def GetEpisodes(url, oc, channel_title):

    try:
        pageElement = HTML.ElementFromURL(url)
    except:
        return
    
    episodes = []
    for item in pageElement.xpath("//*[contains(@class, 'episode-item')]"):
        locked = len(item.xpath(".//*[@class='content-auth']//svg")) > 0
        
        if locked:
            continue

        episode_url = url + item.xpath(".//a/@href")[0].strip()
        
        title = item.xpath("./@data-name")[0].strip()
        
        if title in episodes:
            continue
            
        episodes.append(title)
        
        try:
            thumb = item.xpath(".//img/@src")[0]
        except:
            thumb = R(ICON)
            
        try:
            show = item.xpath("./@data-show-title")[0].strip()
        except:
            show = None
            
        try:
            summary = item.xpath("./@data-description")[0].strip()
        except:
            summary = None
            
        try:
            duration = int(item.xpath("./@data-duration")[0].strip()) * 1000
        except:
            duration = None
            
        try:
            index = int(item.xpath("./@data-episode-number")[0].strip())
        except:
            index = None
            
        try:
            season = int(item.xpath("./@data-season-number")[0].strip())
        except:
            season = None
        
        oc.add(
            EpisodeObject(
                url = episode_url,
                title = title,
                thumb = thumb,
                show = show,
                summary = summary,
                duration = duration,
                source_title = channel_title,
                index = index,
                season = season
            )
        )

##########################################################################################
@route(PREFIX + "/LiveStreams")
def LiveStreams(title, url, thumb):
    oc            = ObjectContainer(title2 = title)
    oc.view_group = "InfoList"
    
    pageElement = HTML.ElementFromURL(url)

    for item in pageElement.xpath("//div[contains(@class, 'slider')]//div"):
        test = item.xpath(".//td")
            
        video        = {}           
        video["url"] = item.xpath(".//a/@href")[0]

        if not '.htm' in video["url"]:
            continue
        
        try:
            video["img"] = item.xpath(".//a//img/@src")[0]
        except:
            video["img"] = None
            
        try:
            video["name"] = item.xpath(".//h3/text()")[0]
        except:
            video["name"] = None

        oc.add(
            EpisodeObject(
                url = video["url"],
                title = video["name"],
                thumb = video["img"]
            )
        )       
        
    return oc

##########################################################################################
@route(PREFIX + "/DLive")
def DLive():
    oc = ObjectContainer(title2 = 'DLive')   
    
    for stream in LIVE_STREAMS:
        oc.add(
            EpisodeObject(
                url = stream['url'],
                title = stream['title'],
                show = stream['subtitle'],
                thumb = stream['thumb']
            )
        )
        
    return oc
